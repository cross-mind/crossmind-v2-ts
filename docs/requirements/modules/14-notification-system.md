# 通知系统 - 需求设计文档

> 📖 **相关文档**：[PRD](../../PRD.md) | [用户旅程](../04-user-journey.md)

**文档版本**: 1.0
**最后更新**: 2024-12-08
**负责人**: 产品团队

---

## 1. 模块概述

### 1.1 模块定位

**核心价值**: 及时通知用户重要信息，避免遗漏关键事件。

**使用场景**:
- Agent 完成任务通知
- @ 提醒通知
- 任务状态变更通知

### 1.2 优先级

- **P0**: 通知分级、浏览器通知
- **P1**: 邮件通知、通知设置
- **P2**: 推送通知、免打扰

---

## 2. 核心用户场景

### 场景 2.1: 收到 Agent 完成通知

**基本流程**:
```
Agent 完成调研报告
    ↓
系统生成通知
    ↓
浏览器内弹窗："@RedditAgent 完成了调研报告"
    ↓
同时发送邮件（如用户开启）
    ↓
用户点击通知 → 跳转到任务详情
```

### 场景 2.2: 被 @ 提醒

**基本流程**:
```
@Bob 在任务中提到 @Alice
    ↓
系统生成关键通知
    ↓
Alice 收到弹窗通知
    ↓
通知中心显示红点
    ↓
Alice 点击查看 → 跳转到任务评论
```

---

## 3. 功能详细设计

### 3.1 通知分级

| 级别 | 通知类型 | 展示方式 | 优先级 |
|------|---------|---------|-------|
| 关键 | Agent 完成、@ 提醒、任务分配 | 即时弹窗 + 邮件 | P0 |
| 一般 | 任务状态变更、新评论 | 通知中心红点 | P0 |
| 低 | 成员上线、节点创建 | 仅通知中心 | P1 |

### 3.2 通知聚合

**规则**:
- 相同类型通知 5 分钟内合并
- 示例："@Bob 和其他 2 人在任务中评论"

**优先级**: P0

### 3.3 推送策略

#### 3.3.1 浏览器内弹窗

**触发**: 关键通知

**展示**:
- 右下角弹出（3 秒后自动消失）
- 显示标题、内容、时间
- 点击跳转到详情

**优先级**: P0

#### 3.3.2 浏览器通知 (P1)

**触发**: 关键通知 + 用户不在当前标签页

**权限**: 首次使用时请求通知权限

**优先级**: P1

#### 3.3.3 邮件通知 (P1)

**触发**: 关键通知 + 用户开启邮件通知

**内容**: 标题、摘要、跳转链接

**频率限制**: 同类型邮件 1 小时内最多 1 封

**优先级**: P1

### 3.4 通知中心

**入口**: 顶部工具栏铃铛图标

**展示**:
- 未读通知数量（红点）
- 通知列表（时间倒序）
- 标记已读/全部已读
- 通知过滤（按类型）

**优先级**: P0

### 3.5 通知设置 (P1)

**可配置**:
- 通知级别：全部/仅关键/关闭
- 邮件通知：开启/关闭
- 免打扰时段：设置时间段

**优先级**: P1

---

## 4. 业务规则

### 4.1 通知触发规则

| 事件 | 通知对象 | 级别 |
|------|---------|------|
| Agent 完成 | 雇主 | 关键 |
| @ 提醒 | 被提到的用户 | 关键 |
| 任务分配 | 被分配人 | 关键 |
| 任务状态变更 | 负责人 | 一般 |
| 新评论 | 任务参与者 | 一般 |
| 即将到期 | 负责人 | 一般 |
| 成员上线 | 所有在线成员 | 低 |

### 4.2 通知合并规则

**5 分钟内相同类型**: 合并为 1 条

**示例**:
- 单独："@Bob 评论了任务"
- 合并："@Bob 和 @Alice 评论了任务"

---

## 5. 验收标准

- [ ] 通知及时触发（< 1s）
- [ ] 分级正确
- [ ] 聚合正确
- [ ] 通知中心功能正常

---

## 附录

### A. 术语表

| 术语 | 定义 |
|-----|-----|
| 通知分级 | 按重要性分为关键/一般/低 |
| 通知聚合 | 相同类型通知合并显示 |
| 免打扰 | 特定时段不发送通知 |

### B. 变更历史

| 版本 | 日期 | 变更内容 | 负责人 |
|-----|------|---------|-------|
| 1.0 | 2024-12-08 | 初始版本 | 产品团队 |
